"use strict";$(function(){var a=Cookie.get("uid");var i=function(i){for(var t=decodeURIComponent(location.search.slice(1)).split("&"),e=0;e<t.length;e++){var a=t[e].split("=");if(i==a[0])return a[1]}}("gid"),o=[],s=!0,d=0,l=0,c=0,t=!0,e=!0,n=0;$.ajax({type:"GET",cache:!1,url:"../api/detail.php",data:{gid:i},success:function(i){var t=JSON.parse(i).datalist;$(".head_link .topname").html(t.goodname),o=t.bigimg.split("-");var e=t.smallimg.split("-").map(function(i){return'<img src="'+i+'">'}).join("");$(".img_change .img_list").html(e),$(".img_change .img_list").find("img").eq(0).addClass("img_active"),d=$(".img_box .img_list").find("img").eq(0).width()+9,l=d*$(".img_box .img_list").find("img").size(),$(".img_box .img_list").eq(0).css("width",l+"px"),c=l-$(".img_box").eq(0).width();var a=$(".good_l .good_big").html()+'<img src="'+o[0]+'">';$(".good_l .good_big").html(a),$(".good_l .glass").html('<img src="'+o[0]+'">'),$(".good_mess .good_name").html(t.goodname),$(".good_mess .introduction").html(t.jianjie),$(".good_mess .good_price").html('<span class="title">快乐价</span>\n                                                ￥<span class="price">'+t.price+"</span>\n                                                <del>￥"+t.delprice+"</del>"),t.yunfei<=0?$(".freight .fre_con").html("包邮"):$(".freight .fre_con").html(t.yunfei);var s=t.color.split("-").map(function(i){return"<li>"+i+"<i></i></li>"}).join("");$(".color .check").html(s),$(".color .check").find("li").eq(0).addClass("good_active");var n=t.size.split("-").map(function(i){return"<li>"+i+"<i></i></li>"}).join("");$(".size .check").html(n),$(".size .check").find("li").eq(0).addClass("good_active"),$(".num").attr("data-id",t.kucun),$(".welfare").find("span").html(t.price/100),$(".btn .addCart").attr("data-id",t.gid)}});var r=[];r[0]=$(".parameter").eq(0).offset().top-80,r[1]=$(".detail").eq(0).offset().top-80,r[2]=$(".distribution").eq(0).offset().top-80,r[3]=$(".evaluation").eq(0).offset().top-80;var g=$(".details").eq(0).offset().top;$(".img_change").find(".prev").eq(0).click(function(){if(l>$(".img_box").eq(0).width()&&((i=(i=$(".img_box .img_list").eq(0).css("left")).slice(0,-2))<0&&t)){t=!1,n--,console.log(n);var i=d*n;$(".img_box .img_list").eq(0).animate({left:-i+"px"},function(){t=!0})}}),$(".img_change").find(".next").eq(0).click(function(){if(l>$(".img_box").eq(0).width()&&(i=(i=$(".img_box .img_list").eq(0).css("left")).slice(0,-2),-c<i&&e)){e=!1,n++,console.log(n);var i=d*n;$(".img_box .img_list").eq(0).animate({left:-i+"px"},function(){e=!0})}}),$(".img_change .img_list").on("mouseenter","img",function(){$(".img_change .img_list").find("img").removeClass("img_active"),$(this).addClass("img_active"),$(".good_big").find("img").eq(0).prop("src",o[$(this).index()]),$(".glass").find("img").eq(0).prop("src",o[$(this).index()])}),$(".good_big").eq(0).mouseover(function(){$(".good_big .area").eq(0).show(),$(".glass").eq(0).show()}),$(".good_big").eq(0).mouseout(function(){$(".good_big .area").eq(0).hide(),$(".glass").eq(0).hide()}),$(".good_l .good_big").on("mousemove",".mask",function(i){var t=i.pageX-$(".good_big").offset().left-$(".area").width()/2,e=i.pageY-$(".good_big").offset().top-$(".area").height()/2;t<0&&(t=0),t>$(this).width()-$(".area").width()&&(t=$(this).width()-$(".area").width()),e<0&&(e=0),e>$(this).height()-$(".area").height()&&(e=$(this).height()-$(".area").height()),$(".area").css({left:t,top:e});var a=t/($(".mask").width()-$(".area").width()),s=e/($(".mask").height()-$(".area").height());$(".glass img").css({left:-a*($(".glass img").width()-$(".glass").width()),top:-s*($(".glass img").height()-$(".glass").height())})}),$(document).on("scroll",function(){var i=$(document).scrollTop();g<i?$(".run_top").eq(0).slideDown():$(".run_top").eq(0).slideUp(),i>r[0]&&i<r[1]&&($(".details .details_btn").find("a").removeClass("btn_active"),$(".details .details_btn").find("a").eq(0).addClass("btn_active"),$(".run_top ul").find("a").removeClass("run_active"),$(".run_top ul").find("a").eq(0).addClass("run_active")),i>r[1]&&i<r[2]&&($(".details .details_btn").find("a").removeClass("btn_active"),$(".details .details_btn").find("a").eq(1).addClass("btn_active"),$(".run_top ul").find("a").removeClass("run_active"),$(".run_top ul").find("a").eq(1).addClass("run_active")),i>r[2]&&i<r[3]&&($(".details .details_btn").find("a").removeClass("btn_active"),$(".details .details_btn").find("a").eq(2).addClass("btn_active"),$(".run_top ul").find("a").removeClass("run_active"),$(".run_top ul").find("a").eq(2).addClass("run_active")),i>r[3]&&($(".details .details_btn").find("a").removeClass("btn_active"),$(".details .details_btn").find("a").eq(3).addClass("btn_active"),$(".run_top ul").find("a").removeClass("run_active"),$(".run_top ul").find("a").eq(3).addClass("run_active"))}),$(".details .details_btn").find("a").click(function(){$("html,body").animate({scrollTop:r[$(this).index()]+5},"slow")}),$(".run_top ul").find("li").click(function(){$("html,body").animate({scrollTop:r[$(this).index()]+5},"slow")}),$(".good_mess .check").on("click","li",function(){$(this).siblings().removeClass("good_active"),$(this).addClass("good_active")}),$(".num .sub").click(function(){var i=1*$(".num .input_con").eq(0).val();1<i&&(--i,$(".num .input_con").eq(0).val(i))}),$(".num .add").click(function(){var i=1*$(".num").eq(0).attr("data-id"),t=1*$(".num .input_con").eq(0).val();t<i&&(++t,$(".num .input_con").eq(0).val(t))}),$(".num .input_con").blur(function(){var i=1*$(".num").eq(0).attr("data-id"),t=1*$(this).val();i<t&&$(this).val(i),t<1&&$(this).val(1)});var m=$(".good_mess .btn").find(".addCart").eq(0).offset();$(".good_mess .btn").find(".addPoint").eq(0).css({left:m.left+60,top:m.top-10}),$(".good_mess .btn").find(".addCart").eq(0).click(function(i){var t=$(".num .input_con").val(),e=$(this).attr("data-id");a?$.ajax({type:"GET",cache:!1,url:"../api/insertGood.php",data:{gid:e,uid:a,nums:t},success:function(i){var t=JSON.parse(i);if("0"==t.code){if(s){s=!1;var e=$(".side_cart").eq(0).offset();$(this).next().animate({left:e.left,top:e.top,opacity:1},1e3,function(){$(".good_mess .btn").find(".addPoint").eq(0).css({left:m.left+60,top:m.top-10,opacity:0}),s=!0;var i=1*$(".sidebar .side_cart").find("span").html()+1;$(".sidebar .side_cart").find("span").html(i)})}}else alert(t.message)}.bind($(this))}):(alert("请先登录！"),location.href="../html/login.html")})});