"use strict";$(function(){var a=Cookie.get("uid");function i(){$(".list_head").hide(),$(".cartlist").hide(),$(".account").hide(),$(".notip").show()}function n(){var t=0,a=$(".cart_list").find(".sCheck");a.each(function(){$(this).prop("checked")&&++t}),t==a.size()?$(".all_check").prop("checked",!0):$(".all_check").prop("checked",!1)}function e(){var t=$(".cart_list .good_check").find("input"),a=0,n=0;t.each(function(){if($(this).parent().parent().removeClass("list_active"),$(this).prop("checked")){n++;var t=$(this).parent().nextAll(".good_total").text();t=t.slice(1),a+=1*t,$(this).parent().parent().addClass("list_active")}}),$(".account .good_num").find("span").html(n),$(".account .good_sum").find("span").html("￥"+a.toFixed(2)),0==a?$(".buy_btn a").css("background","#ccc"):$(".buy_btn a").css("background","#C41F3A")}function c(t){var a=(1*t.parent().parent().find(".good_price span").html()*(1*t.parent().find(".put").val())).toFixed(2);t.parent().parent().find(".good_total span").html(a)}$(".buy_btn a").css("background","#ccc"),$.ajax({type:"GET",cache:!1,url:"../api/cart.php",data:{uid:a},success:function(t){var a=JSON.parse(t);if("0"==a.code){var s=a.datalist,n=s.map(function(t){return t.sname});$.unique(n);var d="";n.forEach(function(t){var a="",n="";"快乐购官方"==t&&(n="<span>自营</span>"),a='<dl class="list_part">\n                                <dt class="clearfix list_title">\n                                    <div class="tit_l fl">\n                                        <input type="checkbox" class="sCheck">'+n+t+'\n                                    </div>\n                                    <div class="tit_r fr">\n                                        <span>在线支付满129.00包邮</span>\n                                    </div>\n                                </dt>';for(var i=0;i<s.length;i++)if(s[i].sname==t){var e=s[i].smallimg.split("-")[0],c=(1*s[i].price).toFixed(2);a+='<dd class="list_con clearfix" data-id="'+s[i].cid+'">\n                                            <div class="good_check fl">\n                                                <input type="checkbox">\n                                            </div>\n                                            <div class="good_img">\n                                                <img src="'+e+'" alt="">\n                                            </div>\n                                            <div class="good_name"><a href="javascript:;">'+s[i].goodname+'</a></div>\n                                            <div class="good_price">￥<span>'+c+'</span></div>\n                                            <div class="good_num" data-id="'+s[i].kucun+'">\n                                                <input type="button" class="sub" value="-">\n                                                <input type="text" class="put" value="'+s[i].nums+'" data-num="'+s[i].nums+'">\n                                                <input type="button" class="add" value="+">\n                                            </div>\n                                            <div class="good_total">￥<span>'+(s[i].price*s[i].nums).toFixed(2)+'</span></div>\n                                            <div class="remove">\n                                                <input type="button" class="del" value="删除">\n                                            </div>\n                                        </dd>'}d+=a+="</dl>"}),$(".cart_list").html(d)}else i()}}),a&&($("#header .loginStatus").find(".login").eq(0).hide(),$("#header .loginStatus").find(".reg").eq(0).hide(),$("#header .loginStatus").find(".reg_tip").eq(0).hide(),$("#header .loginStatus").find("span").eq(0).html("欢迎您，"+a),$("#header .loginStatus").find(".logout").eq(0).show()),$("#header .loginStatus").find(".logout").click(function(){if(a&&confirm("您确定要退出吗？")){var t=new Date;t.setDate(t.getDate()-1),document.cookie="uid=out;expires="+t.toUTCString()+";path=/",location.href="index.html"}}),$("#header .loginStatus .reg_tip").find("i").eq(0).click(function(){$(this).parent().hide()}),$("#header .downApp").hover(function(){$(this).find("div").eq(0).show()},function(){$(this).find("div").eq(0).hide()}),$("#header .service").hover(function(){$(this).addClass("ser_active"),$(this).find(".ser_content").eq(0).show()},function(){$(this).removeClass("ser_active"),$(this).find(".ser_content").eq(0).hide()}),$(".all_check").click(function(){var t=$(this).prop("checked");$(".all_check").prop("checked",t),$(".list_part .tit_l").find("input").prop("checked",t),$(".list_con .good_check").find("input").prop("checked",t),e()}),$(".cart_list").on("click",".sCheck",function(){var t=$(this).prop("checked");$(this).parent().parent().parent().find(".good_check input").prop("checked",t);n(),e()}),$(".cart_list").on("click",".good_check input",function(){0==$(this).prop("checked")&&($(".all_check").prop("checked",!1),$(this).parent().parent().parent().find(".tit_l input").prop("checked",!1)),function(t){var a=0,n=t.parent().parent().parent().find("dd .good_check input");n.each(function(){$(this).prop("checked")&&++a}),a==n.size()&&t.parent().parent().prevAll("dt").find(".sCheck").prop("checked",!0);e()}($(this)),n()}),$(".cart_list").on("click",".sub",function(){var t=$(this).parent().parent().attr("data-id");$.ajax({type:"GET",url:"../api/addSub.php",cache:!1,data:{cid:t,type:"sub"},success:function(t){var a=JSON.parse(t);"0"==a.code&&($(this).parent().find(".put").val(a.nums),$(this).parent().find(".put").attr("data-num",a.nums),c($(this)),e())}.bind($(this))})}),$(".cart_list").on("click",".add",function(){var t=$(this).parent().parent().attr("data-id");$.ajax({type:"GET",url:"../api/addSub.php",cache:!1,data:{cid:t,type:"add"},success:function(t){var a=JSON.parse(t);"0"==a.code&&($(this).parent().find(".put").val(a.nums),$(this).parent().find(".put").attr("data-num",a.nums),c($(this)),e())}.bind($(this))})}),$(".cart_list").on("change",".put",function(){var t=$(this).parent().parent().attr("data-id"),a=1*$(this).val(),n=$(this).attr("data-num");isNaN(a)?(alert("只能输入数字"),$(this).val(n)):$.ajax({type:"GET",url:"../api/addSub.php",cache:!1,data:{cid:t,type:a},success:function(t){var a=JSON.parse(t);"0"==a.code&&($(this).val(a.nums),$(this).attr("data-num",a.nums),c($(this)),e())}.bind($(this))})}),$(".cart_list").on("click",".del",function(){var t=$(this).parent().parent().attr("data-id");console.log(t);var n=$(this).parent().parent().index();confirm("您确定要移除这个商品吗？")&&$.ajax({type:"GET",url:"../api/newDel.php",data:{cid:t},success:function(t){if("0"==JSON.parse(t).code){var a=$(this).parent().parent().parent();a.children().eq(n).remove(),1==a.children().size()&&a.remove()}0==$(".cart_list").children().length&&i()}.bind($(this))})})});